<!DOCTYPE html>
<html>
<head>
  <title>Roam MVP Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <style>
    * {
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: sans-serif;
    }
    #map {
      height: 100vh;
      width: 100vw;
    }
    .controls {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      z-index: 1000;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      background: rgba(255,255,255,0.9);
      padding: 8px;
      border-radius: 8px;
    }
    .controls select,
    .controls input,
    .controls button {
      font-size: 14px;
      padding: 5px;
      flex: 1 1 120px;
    }
    @media (min-width: 768px) {
      .controls {
        flex-wrap: nowrap;
        gap: 10px;
        top: 10px;
        left: 50px;
        right: auto;
      }
      .controls select,
      .controls input,
      .controls button {
        flex: unset;
      }
    }
  </style>
</head>
<body>
<div class="controls">
  <input id="map-search" type="text" placeholder="What's the vibe..." />

  <select id="themeDropdown">
    <option value="">Select Theme</option>
    <option value="Quiet Luxury">Quiet Luxury</option>
    <option value="Hedonist's Loop">Hedonist's Loop</option>
    <option value="Creative Recharge">Creative Recharge</option>
    <option value="Wellness Ritual">Wellness Ritual</option>
    <option value="Alt Crawl">Alt Crawl</option>
    <option value="Power Lunch">Power Lunch</option>
    <option value="Cozy Corners">Cozy Corners</option>
    <option value="Flirt & Flow">Flirt & Flow</option>
    <option value="Urban Safari">Urban Safari</option>
  </select>

  <select id="neighborhood-input">
    <option value="">Select Neighborhood</option>
    <option>Alphabet City</option>
    <option>BedStuy</option>
    <option>Bushwick</option>
    <option>Chelsea</option>
    <option>Chinatown</option>
    <option>Clinton Hill</option>
    <option>Downtown Brooklyn</option>
    <option>Dumbo</option>
    <option>East Village</option>
    <option>Gramercy</option>
    <option>Greenpoint</option>
    <option>Greenwich Village</option>
    <option>Lower East Side</option>
    <option>Long Island City</option>
    <option>Midtown</option>
    <option>SoHo</option>
    <option>Tribeca</option>
    <option>Upper East Side</option>
    <option>Upper West Side</option>
    <option>West Village</option>
    <option>Williamsburg</option>
  </select>

  <select id="priceFilter">
    <option value="">Price</option>
    <option value="$">$</option>
    <option value="$$">$$</option>
    <option value="$$$">$$$</option>
    <option value="$$$$">$$$$</option>
  </select>

  <select id="durationDropdown">
    <option value="medium">How Long?</option>
    <option value="short">Short (≤2h)</option>
    <option value="medium">Medium (2.5–5h)</option>
    <option value="long">Long (5.5–8h)</option>
  </select>

  <button id="crawlNowBtn">Crawl Now</button>
  <button id="favoritesCrawlBtn">Favorites Crawl</button>
</div>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>
<script>
  let map;
  let markerCluster = L.markerClusterGroup();
  let allMarkers = [];
  const themes = {
    "Quiet Luxury": ["luxury", "elegant", "refined"],
    "Hedonist's Loop": ["party", "dance", "cocktail"],
    "Creative Recharge": ["art", "gallery", "creative"],
    "Wellness Ritual": ["spa", "wellness", "juice"],
    "Alt Crawl": ["alt", "underground", "grunge"],
    "Power Lunch": ["business", "lunch", "network"],
    "Cozy Corners": ["cozy", "quiet", "nook"],
    "Flirt & Flow": ["romantic", "date", "vibe"],
    "Urban Safari": ["rooftop", "scenic", "explore"]
  };

  window.addEventListener('DOMContentLoaded', () => {
    map = L.map('map').setView([40.72, -73.98], 12);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors & Carto',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map);

    map.addLayer(markerCluster);

    fetch('events.json')
      .then(res => res.json())
      .then(events => {
        events.forEach(ev => {
          const marker = L.marker([parseFloat(ev.lat), parseFloat(ev.lon)]);
          marker.name = ev.name;
          marker.vibe = ev.vibe || '';
          marker.price = ev.price || '';
          marker.tags = (ev.tags || '').toLowerCase().split(',').map(t => t.trim());
          allMarkers.push(marker);
          markerCluster.addLayer(marker);
        });
      });

    document.getElementById('map-search').addEventListener('input', applyFilters);
    document.getElementById('themeDropdown').addEventListener('change', applyFilters);
    document.getElementById('priceFilter').addEventListener('change', applyFilters);

    function applyFilters() {
      const query = document.getElementById('map-search').value.toLowerCase();
      const theme = document.getElementById('themeDropdown').value;
      const price = document.getElementById('priceFilter').value.trim();
      markerCluster.clearLayers();

      allMarkers.forEach(marker => {
        const searchMatch = !query || marker.name.toLowerCase().includes(query) || marker.vibe.toLowerCase().includes(query);
        const priceMatch = !price || (marker.price && marker.price.trim() === price);
        const themeTags = themes[theme] || [];
        const themeMatch = !theme || themeTags.some(tag => marker.tags.includes(tag));

        if (searchMatch && priceMatch && themeMatch) {
          markerCluster.addLayer(marker);
        }
      });
    }
  });
</script>
</body>
</html>
